name: run tests
on: [push]

jobs:
    Test:
        runs-on: ubuntu-latest
        steps:
          - name: ğŸ”¦ Checkout
            uses: actions/checkout@v4
    
          - name: ğŸ§° Setup python
            uses: actions/setup-python@v5
            with:
              python-version: '3.12'
    
          - name: ğŸ“¦ Install dependencies
            run: |
              pip install -r requirements.txt
              pip install pyjwt
              pip install "redis[asyncio]"
    
          - name: ğŸ§ª Run tests
            run: pytest --maxfail=1 --disable-warnings -q
    
          - name: âŒ Em caso de falha
            if: failure()
            run: echo "ğŸš« Os testes falharam. Verifique os logs para mais detalhes."

          - name: âœ… Em caso de sucesso 
            if: success()
            run: echo "âœ… Todos os testes passaram com sucesso!"

          - name: ğŸ“Š Test coverage
            run: |
              pip install coverage
              coverage run -m pytest
              coverage report
              coverage html
              coverage report | grep TOTAL